# 后台配置系统设计文档

## 概述

本文档详细描述了潜空间平台的后台配置系统设计，确保所有内容展示和算法机制都具有可配置性，支持运营团队灵活调整平台展示策略。

## 系统架构

### 1. 配置管理架构

```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│   Admin Panel   │────▶│  Configuration   │────▶│    Frontend     │
│  (配置界面)     │     │      API         │     │   (展示层)      │
└─────────────────┘     └──────────────────┘     └─────────────────┘
         │                        │                         │
         ▼                        ▼                         ▼
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│ Config Database │     │   Redis Cache    │     │  Real-time Sync │
│  (配置存储)     │     │   (配置缓存)     │     │  (实时同步)     │
└─────────────────┘     └──────────────────┘     └─────────────────┘
```

### 2. 配置数据模型

```typescript
// 通用配置模型
interface SystemConfig {
  id: string;
  category: 'content' | 'algorithm' | 'display' | 'feature';
  key: string;
  value: any;
  type: 'string' | 'number' | 'boolean' | 'json' | 'array';
  description: string;
  constraints?: {
    min?: number;
    max?: number;
    enum?: any[];
    pattern?: string;
  };
  lastModified: Date;
  modifiedBy: string;
  version: number;
}
```

## 内容配置系统

### 1. Banner 配置

```typescript
interface BannerConfig {
  // 显示控制
  maxMainBanners: number;        // 主Banner数量（默认1）
  maxSecondaryBanners: number;   // 次要Banner数量（默认2）
  maxReserveBanners: number;     // 预留位数量（默认3）
  
  // 轮播设置
  enableAutoRotate: boolean;     // 是否自动轮播
  rotateInterval: number;        // 轮播间隔（秒）
  transitionEffect: 'fade' | 'slide' | 'zoom';
  
  // 展示规则
  sortingRule: 'manual' | 'click_rate' | 'newest' | 'weighted';
  weightFactors?: {
    clicks: number;      // 点击权重
    time: number;        // 时效性权重
    priority: number;    // 手动优先级权重
  };
}
```

### 2. 内容沉淀配置

```typescript
interface ContentArchiveConfig {
  // 显示数量
  displayCount: number;          // 展示文章数量（4-10）
  
  // 筛选规则
  filterRules: {
    minViews: number;          // 最小浏览量
    maxAge: number;            // 最大天数
    categories: string[];      // 允许的分类
    excludeTags: string[];     // 排除的标签
  };
  
  // 排序算法
  sortAlgorithm: {
    type: 'views' | 'engagement' | 'ai_score' | 'custom';
    weights?: {
      views: number;           // 浏览量权重
      likes: number;           // 点赞权重
      comments: number;        // 评论权重
      shares: number;          // 分享权重
      recency: number;         // 时效性权重
    };
  };
}
```

### 3. 活动展示配置

```typescript
interface EventDisplayConfig {
  // 基础设置
  maxDisplayEvents: number;      // 最大展示数量
  showPastEvents: boolean;       // 是否显示已结束活动
  pastEventsDays: number;        // 显示多少天内的已结束活动
  
  // 优先级规则
  priorityRules: {
    upcoming: number;          // 即将开始权重
    popular: number;           // 热门活动权重
    recommended: number;       // 推荐活动权重
    capacity: number;          // 剩余名额权重
  };
  
  // 自动推荐
  autoRecommend: {
    enabled: boolean;
    factors: {
      userInterests: boolean;  // 基于用户兴趣
      pastAttendance: boolean; // 基于历史参与
      socialGraph: boolean;    // 基于社交关系
    };
  };
}
```

## 算法配置系统

### 1. 推荐算法配置

```typescript
interface RecommendationConfig {
  // 算法选择
  algorithm: 'collaborative' | 'content_based' | 'hybrid' | 'rule_based';
  
  // 协同过滤参数
  collaborative: {
    minSimilarUsers: number;   // 最小相似用户数
    similarityThreshold: number; // 相似度阈值
    timeDecay: number;         // 时间衰减系数
  };
  
  // 内容推荐参数
  contentBased: {
    featureWeights: {
      tags: number;            // 标签权重
      category: number;        // 分类权重
      author: number;          // 作者权重
      keywords: number;        // 关键词权重
    };
  };
  
  // 混合推荐参数
  hybrid: {
    collaborativeWeight: number; // 协同过滤权重
    contentWeight: number;       // 内容推荐权重
    popularityWeight: number;    // 流行度权重
    randomWeight: number;        // 随机推荐权重
  };
  
  // 实时调整
  realtimeAdjustment: {
    enabled: boolean;
    factors: {
      clickThrough: boolean;   // 点击率反馈
      dwellTime: boolean;      // 停留时间反馈
      engagement: boolean;     // 互动反馈
    };
  };
}
```

### 2. 搜索算法配置

```typescript
interface SearchConfig {
  // 搜索权重
  searchWeights: {
    title: number;             // 标题权重
    content: number;           // 内容权重
    tags: number;              // 标签权重
    author: number;            // 作者权重
  };
  
  // 搜索增强
  enhancements: {
    synonyms: boolean;         // 同义词搜索
    fuzzyMatch: boolean;       // 模糊匹配
    semanticSearch: boolean;   // 语义搜索
    spellCorrection: boolean;  // 拼写纠正
  };
  
  // 结果排序
  resultSorting: {
    relevanceWeight: number;   // 相关性权重
    popularityWeight: number;  // 流行度权重
    recencyWeight: number;     // 时效性权重
    authorityWeight: number;   // 权威度权重
  };
}
```

### 3. 匹配算法配置

```typescript
interface MatchingAlgorithmConfig {
  // 匹配维度权重
  dimensionWeights: {
    skills: number;            // 技能匹配权重
    interests: number;         // 兴趣匹配权重
    experience: number;        // 经验匹配权重
    personality: number;       // 性格匹配权重
    availability: number;      // 时间匹配权重
    location: number;          // 地理位置权重
  };
  
  // 匹配策略
  strategy: {
    minScore: number;          // 最低匹配分数
    maxResults: number;        // 最大返回结果数
    diversityFactor: number;   // 多样性因子
    complementarity: boolean;  // 互补性匹配
  };
  
  // AI 增强
  aiEnhancement: {
    enabled: boolean;
    model: 'gpt-4' | 'claude' | 'custom';
    factors: {
      semanticAnalysis: boolean;
      behaviorPrediction: boolean;
      successProbability: boolean;
    };
  };
}
```

## 展示规则配置

### 1. 产品展示配置

```typescript
interface ProductDisplayConfig {
  // Tab 配置
  tabs: {
    aiProducts: {
      enabled: boolean;
      label: string;
      icon: string;
      maxDisplay: number;
      sortBy: 'usage' | 'rating' | 'newest' | 'trending';
    };
    alumniProducts: {
      enabled: boolean;
      label: string;
      icon: string;
      requireVerification: boolean;
      highlightBadge: string;
    };
    tutorials: {
      enabled: boolean;
      label: string;
      icon: string;
      filterByLevel: boolean;
      showDuration: boolean;
    };
  };
  
  // 展示样式
  displayStyle: {
    layout: 'grid' | 'list' | 'carousel';
    columns: {
      desktop: number;
      tablet: number;
      mobile: number;
    };
    showMetrics: boolean;
    enableHover: boolean;
  };
}
```

### 2. 讨论区配置

```typescript
interface DiscussionConfig {
  // 显示设置
  display: {
    maxPosts: number;          // 最大显示帖子数
    sortOptions: string[];     // 可用排序选项
    defaultSort: string;       // 默认排序
    showMetrics: {
      replies: boolean;
      views: boolean;
      likes: boolean;
      time: boolean;
    };
  };
  
  // 内容过滤
  filtering: {
    hideDownvoted: boolean;    // 隐藏低分帖子
    downvoteThreshold: number; // 低分阈值
    requireApproval: boolean;  // 需要审核
    autoModeration: {
      enabled: boolean;
      sensitiveWords: string[];
      spamDetection: boolean;
    };
  };
  
  // 热度算法
  hotAlgorithm: {
    formula: 'reddit' | 'hackernews' | 'custom';
    factors: {
      age: number;             // 时间衰减
      score: number;           // 分数权重
      comments: number;        // 评论权重
      velocity: number;        // 增长速度权重
    };
  };
}
```

## 实时配置更新

### 1. 配置热更新机制

```typescript
interface ConfigUpdateSystem {
  // 更新策略
  updateStrategy: {
    immediate: boolean;        // 立即生效
    scheduled: boolean;        // 定时生效
    gradual: boolean;          // 渐进式更新
  };
  
  // A/B 测试
  abTesting: {
    enabled: boolean;
    experiments: Array<{
      name: string;
      configKey: string;
      variants: any[];
      distribution: number[];  // 流量分配
      metrics: string[];       // 追踪指标
    }>;
  };
  
  // 回滚机制
  rollback: {
    autoRollback: boolean;     // 自动回滚
    errorThreshold: number;    // 错误阈值
    historyRetention: number;  // 历史版本保留数
  };
}
```

### 2. 配置监控

```typescript
interface ConfigMonitoring {
  // 性能监控
  performance: {
    trackLoadTime: boolean;    // 追踪加载时间
    trackRenderTime: boolean;  // 追踪渲染时间
    alertThreshold: number;    // 告警阈值
  };
  
  // 效果监控
  effectiveness: {
    metrics: {
      clickRate: boolean;      // 点击率
      engagement: boolean;     // 互动率
      conversion: boolean;     // 转化率
      retention: boolean;      // 留存率
    };
    reportFrequency: 'hourly' | 'daily' | 'weekly';
  };
  
  // 审计日志
  audit: {
    logAllChanges: boolean;    // 记录所有变更
    retention: number;         // 日志保留天数
    alertOnChange: string[];   // 变更通知人员
  };
}
```

## 配置界面设计

### 1. 配置中心首页
- 配置分类导航
- 快速搜索功能
- 最近修改记录
- 配置健康状态

### 2. 配置编辑界面
- 可视化配置表单
- 实时预览功能
- 配置验证提示
- 版本对比功能

### 3. 高级功能
- JSON 编辑模式
- 批量导入/导出
- 配置模板管理
- 权限控制设置

## 数据安全

### 1. 访问控制
- 基于角色的权限管理
- 配置项级别的权限控制
- 操作审计追踪

### 2. 数据保护
- 配置数据加密存储
- 敏感信息脱敏展示
- 定期备份机制

## 实施计划

### Phase 1: 基础配置系统
1. 配置数据模型设计
2. 配置管理 API 开发
3. 基础配置界面实现

### Phase 2: 内容配置
1. Banner 配置功能
2. 内容展示配置
3. 活动管理配置

### Phase 3: 算法配置
1. 推荐算法配置
2. 搜索算法配置
3. 匹配算法配置

### Phase 4: 高级功能
1. A/B 测试系统
2. 实时监控系统
3. 智能优化建议

## 最佳实践

1. **配置命名规范**
   - 使用语义化的 key 名称
   - 采用分层命名空间
   - 保持命名一致性

2. **默认值设置**
   - 所有配置都应有合理默认值
   - 默认值应保证系统正常运行
   - 定期审查默认值的合理性

3. **变更管理**
   - 重要配置变更需要审批
   - 保留完整的变更历史
   - 支持配置回滚功能

4. **性能考虑**
   - 使用缓存减少数据库查询
   - 配置更新采用增量同步
   - 避免频繁的配置变更